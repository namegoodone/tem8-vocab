<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸“å…«è¯æ±‡Â·æ¶ˆç­ç³»ç»Ÿ Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: system-ui, sans-serif; background-color: #f1f5f9; }
        /* ä¾§è¾¹æ æ ·å¼ */
        .sidebar { transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); z-index: 50; width: 320px; }
        @media (max-width: 1024px) {
            .sidebar { position: fixed; height: 100vh; transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); }
        }
        .main-content { height: 100vh; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        /* æ¨¡ç³Šæ•ˆæœ */
        .review-mode .blur-content { filter: blur(20px); transition: filter 0.3s; cursor: pointer; }
        .review-mode .blur-content.active { filter: blur(0); }
        /* é€‰ä¸­çŠ¶æ€ */
        .chapter-card.active { border-color: #3b82f6; background-color: #eff6ff; ring: 2px; ring-color: #3b82f6; }
        .no-data { py: 40px; text-align: center; color: #94a3b8; font-style: italic; }
    </style>
</head>
<body class="flex overflow-hidden">

    <div id="overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/60 z-40 hidden lg:hidden"></div>

    <aside id="sidebar" class="sidebar bg-white border-r border-slate-200 flex flex-col shrink-0 shadow-xl lg:shadow-none">
        <div class="p-6 border-b bg-slate-50">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-black text-slate-800">å­¦ä¹ ç›®å½•</h2>
                <button onclick="location.reload()" class="text-xs bg-slate-200 px-2 py-1 rounded">åˆ·æ–°</button>
            </div>
            <div class="grid grid-cols-2 gap-2">
                <button onclick="syncCopy()" class="bg-blue-600 text-white py-2 rounded-xl text-[10px] font-bold">åŒæ­¥ç å¯¼å‡º</button>
                <button onclick="syncPaste()" class="bg-slate-800 text-white py-2 rounded-xl text-[10px] font-bold">åŒæ­¥ç å¯¼å…¥</button>
            </div>
        </div>
        <div id="chapterStats" class="flex-1 overflow-y-auto p-4 space-y-3 bg-slate-50">
            </div>
    </aside>

    <main class="main-content flex-1 flex flex-col min-w-0" id="scrollContainer">
        <header class="bg-white border-b p-4 flex items-center justify-between sticky top-0 z-30 lg:hidden">
            <button onclick="toggleSidebar()" class="p-2 bg-blue-600 text-white rounded-lg text-xs font-bold shadow-lg">é€‰æ‹©ç« èŠ‚</button>
            <h1 class="font-black text-slate-700 truncate px-4" id="mobileHeaderTitle">åŠ è½½æ•°æ®ä¸­...</h1>
        </header>

        <div class="p-4 lg:p-10 max-w-4xl mx-auto w-full">
            <div class="hidden lg:flex justify-between items-center mb-8">
                <h2 id="currentTitle" class="text-3xl font-black text-slate-800">è¯·ä»å·¦ä¾§é€‰æ‹©ç« èŠ‚</h2>
                <div class="flex bg-white p-1 rounded-2xl shadow-sm border">
                    <button onclick="setMode('normal')" id="nBtn" class="px-8 py-2 rounded-xl text-sm font-bold bg-blue-600 text-white">æµè§ˆ</button>
                    <button onclick="setMode('review')" id="rBtn" class="px-8 py-2 rounded-xl text-sm font-bold text-slate-400">å¤ä¹ </button>
                </div>
            </div>

            <div class="lg:hidden flex bg-white p-1 rounded-xl shadow-sm border mb-6">
                <button onclick="setMode('normal')" id="mnBtn" class="flex-1 py-2 rounded-lg text-sm font-bold bg-blue-600 text-white">æµè§ˆ</button>
                <button onclick="setMode('review')" id="mrBtn" class="flex-1 py-2 rounded-lg text-sm font-bold text-slate-400">å¤ä¹ </button>
            </div>

            <div id="vocabList" class="space-y-8 pb-32">
                </div>
        </div>
    </main>

    <script>
        let allData = [];
        let masteredWords = new Set();
        let isReviewMode = false;
        let currentChapter = "";
        let viewType = "todo"; // 'todo' æˆ– 'mastered'

        async function init() {
            // 1. è¯»å–è¿›åº¦
            const saved = localStorage.getItem('vocab_sync_v5');
            if (saved) {
                try {
                    const p = JSON.parse(saved);
                    masteredWords = new Set(p.mastered || []);
                    currentChapter = p.lastChapter || "";
                    viewType = p.lastViewType || "todo";
                } catch(e) {}
            }

            // 2. åŠ è½½ JSON æ•°æ®
            try {
                const res = await fetch('vocab.json');
                if (!res.ok) throw new Error();
                allData = await res.json();
                
                renderStats();
                
                // 3. è‡ªåŠ¨è½½å…¥é»˜è®¤ç« èŠ‚
                const chapters = [...new Set(allData.map(d => d.chapter))];
                if (!currentChapter && chapters.length > 0) currentChapter = chapters[0];
                
                if (currentChapter) {
                    loadChapter(currentChapter, viewType);
                } else {
                    document.getElementById('vocabList').innerHTML = `<div class="no-data">æ•°æ®æ ¼å¼æœ‰è¯¯ï¼Œæœªæ‰¾åˆ° Chapter å­—æ®µ</div>`;
                }
            } catch (e) {
                document.getElementById('vocabList').innerHTML = `<div class="no-data py-20 bg-white rounded-3xl border-2 border-dashed mx-4">
                    <p class="text-slate-500 mb-4">âš ï¸ æ— æ³•åŠ è½½ vocab.json</p>
                    <p class="text-xs text-slate-400 px-10">è¯·ç¡®ä¿æ–‡ä»¶ä¸ HTML åœ¨åŒä¸€æ–‡ä»¶å¤¹ï¼Œå¹¶ä½¿ç”¨ PyCharm é¢„è§ˆæˆ– Web æœåŠ¡å™¨æ‰“å¼€ã€‚</p>
                </div>`;
            }
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
            document.getElementById('overlay').classList.toggle('hidden');
        }

        function renderStats() {
            const groups = [...new Set(allData.map(d => d.chapter))];
            const container = document.getElementById('chapterStats');
            
            container.innerHTML = groups.map(ch => {
                const list = allData.filter(d => d.chapter === ch);
                const mCount = list.filter(d => masteredWords.has(d.word)).length;
                const tCount = list.length - mCount;
                const isActive = ch === currentChapter;

                return `
                <div class="chapter-card p-4 rounded-2xl border-2 transition-all bg-white ${isActive ? 'active border-blue-500 shadow-md' : 'border-transparent'}">
                    <div class="font-black text-slate-700 mb-3">${ch}</div>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="loadChapter('${ch}', 'todo')" class="py-3 rounded-xl text-[10px] font-black transition-all ${viewType==='todo' && isActive ? 'bg-blue-600 text-white' : 'bg-slate-100 text-slate-500'}">
                            å¾…å­¦ä¹  ${tCount}
                        </button>
                        <button onclick="loadChapter('${ch}', 'mastered')" class="py-3 rounded-xl text-[10px] font-black transition-all ${viewType==='mastered' && isActive ? 'bg-emerald-600 text-white' : 'bg-slate-100 text-slate-500'}">
                            å·²æŒæ¡ ${mCount}
                        </button>
                    </div>
                </div>`;
            }).join('');
        }

        function loadChapter(ch, type) {
            currentChapter = ch;
            viewType = type;
            saveProgress();
            renderStats();
            
            const titleStr = `${ch} Â· ${type === 'todo' ? 'å¾…å­¦ä¹ ' : 'å·²æŒæ¡'}`;
            document.getElementById('currentTitle').innerText = titleStr;
            document.getElementById('mobileHeaderTitle').innerText = titleStr;
            
            const list = allData.filter(d => {
                const isM = masteredWords.has(d.word);
                return d.chapter === ch && (type === 'todo' ? !isM : isM);
            });
            
            renderList(list);
            document.getElementById('scrollContainer').scrollTop = 0;

            if (window.innerWidth < 1024) {
                document.getElementById('sidebar').classList.remove('open');
                document.getElementById('overlay').classList.add('hidden');
            }
        }

        function renderList(data) {
            const container = document.getElementById('vocabList');
            if (data.length === 0) {
                container.innerHTML = `<div class="py-20 text-center text-slate-400 font-bold bg-white rounded-3xl border border-slate-200">ğŸ‰ è¯¥åˆ—è¡¨å·²æ¸…ç©ºï¼</div>`;
                return;
            }

            container.innerHTML = data.map(item => {
                const isM = masteredWords.has(item.word);
                return `
                <div class="bg-white rounded-[2.5rem] shadow-xl shadow-slate-200/40 border-2 border-white overflow-hidden">
                    <div class="p-8">
                        <div class="flex justify-between items-start mb-8">
                            <div class="flex-1">
                                <h3 class="text-4xl font-black text-slate-900 tracking-tighter">${item.word}</h3>
                                <div class="text-blue-600 font-mono text-xl mt-2 font-bold">${item.phonetic || ''}</div>
                            </div>
                            <button onclick="toggleWord('${item.word}')" class="shrink-0 ml-4 group">
                                <div class="w-16 h-16 rounded-3xl border-4 flex items-center justify-center transition-all ${isM ? 'bg-emerald-500 border-emerald-500 text-white shadow-lg shadow-emerald-200' : 'border-slate-100 bg-slate-50 text-slate-200'}">
                                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M5 13l4 4L19 7"></path></svg>
                                </div>
                                <p class="text-[10px] font-black mt-1 text-center ${isM ? 'text-emerald-500' : 'text-slate-300'}">${isM ? 'å·²ä¼š' : 'æŒæ¡'}</p>
                            </button>
                        </div>
                        <div class="blur-content space-y-6" onclick="this.classList.toggle('active')">
                            <div class="bg-slate-900 text-white p-6 rounded-3xl shadow-lg">
                                <p class="text-[10px] text-slate-500 font-black mb-2 uppercase tracking-widest">ä¸­æ–‡è§£é‡Š</p>
                                <p class="text-3xl font-black leading-tight">${item.meaning_cn || ''}</p>
                            </div>
                            
                            <p class="text-xl font-bold text-slate-600 leading-relaxed px-2">${item.definition_en || ''}</p>
                            
                            <div class="bg-blue-50 p-6 rounded-[2rem] border-l-[12px] border-blue-400">
                                <p class="text-xl italic text-slate-800 leading-relaxed font-serif">"${item.sentence_en || ''}"</p>
                                <p class="text-lg text-blue-600 font-black mt-4 text-right">â€” ${item.sentence_cn || ''}</p>
                            </div>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        function toggleWord(word) {
            if (masteredWords.has(word)) masteredWords.delete(word);
            else masteredWords.add(word);
            saveProgress();
            // ç›´æ¥é‡æ–°åŠ è½½å½“å‰è§†å›¾
            loadChapter(currentChapter, viewType);
        }

        function saveProgress() {
            localStorage.setItem('vocab_sync_v5', JSON.stringify({
                mastered: [...masteredWords],
                lastChapter: currentChapter,
                lastViewType: viewType
            }));
        }

        function setMode(m) {
            isReviewMode = (m === 'review');
            document.getElementById('vocabList').classList.toggle('review-mode', isReviewMode);
            const styleActive = "flex-1 py-2 rounded-lg text-sm font-bold bg-blue-600 text-white";
            const styleInactive = "flex-1 py-2 rounded-lg text-sm font-bold text-slate-400";
            document.getElementById('nBtn').className = m==='normal' ? styleActive : styleInactive;
            document.getElementById('rBtn').className = m==='review' ? styleActive : styleInactive;
            document.getElementById('mnBtn').className = m==='normal' ? styleActive : styleInactive;
            document.getElementById('mrBtn').className = m==='review' ? styleActive : styleInactive;
        }

        function syncCopy() {
            const code = btoa(unescape(encodeURIComponent(JSON.stringify({
                mastered: [...masteredWords], lastChapter: currentChapter, lastViewType: viewType
            }))));
            navigator.clipboard.writeText(code).then(() => alert("åŒæ­¥ç å·²å¤åˆ¶ï¼"));
        }

        function syncPaste() {
            const code = prompt("ç²˜è´´åŒæ­¥ç ï¼š");
            if (code) {
                try {
                    const p = JSON.parse(decodeURIComponent(escape(atob(code))));
                    masteredWords = new Set(p.mastered);
                    currentChapter = p.lastChapter;
                    viewType = p.lastViewType || "todo";
                    saveProgress();
                    location.reload();
                } catch(e) { alert("ç æ— æ•ˆ"); }
            }
        }

        init();
    </script>
</body>
</html>
