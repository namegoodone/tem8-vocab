<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸“å…«è¯æ±‡Â·è¿›åº¦åŒæ­¥ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 280px; background: white; border-right: 1px solid #e2e8f0; display: flex; flex-direction: column; }
        .main-content { flex: 1; overflow-y: auto; padding: 2rem; scroll-behavior: smooth; }
        .review-mode .blur-content { filter: blur(6px); transition: filter 0.3s; cursor: pointer; }
        .review-mode .blur-content:hover, .review-mode .blur-content.active { filter: blur(0); }
        .chapter-item.active { background-color: #eff6ff; color: #2563eb; border-right: 4px solid #2563eb; font-weight: 600; }
        .word-card.mastered { opacity: 0.4; filter: grayscale(1); }
        .mastered-badge { display: none; }
        .mastered .mastered-badge { display: block; }
    </style>
</head>
<body>
    <aside class="sidebar shadow-xl z-10">
        <div class="p-6 border-b bg-slate-50">
            <h2 class="text-xl font-bold text-slate-800">ä¸“å…«è¯æ±‡è¿›åº¦</h2>
            <div class="mt-2 h-2 w-full bg-slate-200 rounded-full overflow-hidden">
                <div id="progressBar" class="h-full bg-blue-500 transition-all" style="width: 0%"></div>
            </div>
            <p class="text-[10px] text-slate-400 mt-1" id="progressText">æŒæ¡è¿›åº¦: 0%</p>
            
            <div class="flex gap-2 mt-4">
                <input type="file" id="importFile" class="hidden" accept=".json" onchange="importData(event)">
                <button onclick="document.getElementById('importFile').click()" class="flex-1 bg-emerald-50 text-emerald-600 py-2 rounded-lg text-xs font-bold hover:bg-emerald-100">ğŸ“¥ å¯¼å…¥è¿›åº¦</button>
                <button onclick="exportData()" class="flex-1 bg-blue-50 text-blue-600 py-2 rounded-lg text-xs font-bold hover:bg-blue-100">ğŸ“¤ å¯¼å‡ºè¿›åº¦</button>
            </div>
        </div>
        <nav id="chapterNav" class="flex-1 overflow-y-auto py-2"></nav>
    </aside>

    <main class="main-content">
        <header class="mb-8 flex flex-col md:flex-row md:items-end justify-between gap-6">
            <div>
                <h1 class="text-3xl font-800 text-slate-900 tracking-tight" id="currentChapterTitle">è½½å…¥ä¸­...</h1>
                <div class="flex items-center gap-4 mt-4">
                    <div class="flex bg-white p-1 rounded-xl shadow-sm border border-slate-200">
                        <button onclick="setMode('normal')" id="nBtn" class="px-5 py-2 rounded-lg text-sm font-semibold bg-blue-600 text-white shadow-sm">æµè§ˆ</button>
                        <button onclick="setMode('review')" id="rBtn" class="px-5 py-2 rounded-lg text-sm font-semibold text-slate-500">å¤ä¹ </button>
                    </div>
                    <label class="flex items-center gap-2 text-sm text-slate-500 cursor-pointer">
                        <input type="checkbox" id="hideMastered" onchange="toggleHideMastered()" class="rounded text-blue-600"> éšè—å·²æŒæ¡
                    </label>
                </div>
            </div>
        </header>

        <div id="vocabList" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6"></div>
    </main>

    <script>
        let allData = [];
        let masteredWords = new Set(); // å­˜å‚¨å·²æŒæ¡å•è¯çš„ Set
        let isReviewMode = false;
        let currentChapter = "";

        // åˆå§‹åŒ–
        async function init() {
            // å…ˆå°è¯•ä» LocalStorage è¯»å–è¿›åº¦
            const savedProgress = localStorage.getItem('masteredWords');
            if (savedProgress) masteredWords = new Set(JSON.parse(savedProgress));

            try {
                const response = await fetch('vocab.json');
                const data = await response.json();
                loadContent(data);
            } catch (err) {
                document.getElementById('vocabList').innerHTML = `<div class="col-span-full text-center py-20 bg-white rounded-3xl">è¯·ç‚¹å‡»å·¦ä¾§â€œå¯¼å…¥è¿›åº¦â€é€‰æ‹©æ‚¨çš„ JSON æ–‡ä»¶</div>`;
            }
        }

        function loadContent(data) {
            allData = data;
            // æ¢å¤ä¸Šæ¬¡å­¦ä¹ çš„ç« èŠ‚
            currentChapter = localStorage.getItem('lastChapter') || allData[0].chapter;
            renderNav();
            loadChapter(currentChapter);
            updateProgress();
        }

        // æ ‡è®°æŒæ¡
        function toggleMastered(word) {
            if (masteredWords.has(word)) masteredWords.delete(word);
            else masteredWords.add(word);
            
            localStorage.setItem('masteredWords', JSON.stringify([...masteredWords]));
            updateProgress();
            loadChapter(currentChapter); // åˆ·æ–°å½“å‰æ˜¾ç¤º
        }

        function updateProgress() {
            const percent = ((masteredWords.size / allData.length) * 100).toFixed(1);
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('progressText').innerText = `å·²æŒæ¡: ${masteredWords.size} / ${allData.length} (${percent}%)`;
        }

        // å¯¼å‡ºï¼šå°†è¿›åº¦æ‰“åŒ…è¿› JSON
        function exportData() {
            const exportObj = {
                data: allData,
                progress: [...masteredWords],
                lastChapter: currentChapter
            };
            const blob = new Blob([JSON.stringify(exportObj)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = `ä¸“å…«è¿›åº¦å¤‡ä»½_${new Date().toLocaleDateString()}.json`;
            a.click();
        }

        // å¯¼å…¥ï¼šæ¢å¤è¯åº“+è¿›åº¦
        function importData(event) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const imported = JSON.parse(e.target.result);
                if (imported.progress) {
                    masteredWords = new Set(imported.progress);
                    localStorage.setItem('masteredWords', JSON.stringify(imported.progress));
                    loadContent(imported.data);
                } else {
                    loadContent(imported);
                }
                alert("è¿›åº¦å·²æˆåŠŸåŒæ­¥ï¼");
            };
            reader.readAsText(event.target.files[0]);
        }

        function renderNav() {
            const groups = [...new Set(allData.map(item => item.chapter))];
            document.getElementById('chapterNav').innerHTML = groups.map(ch => `
                <div onclick="loadChapter('${ch}')" id="nav-${ch}" class="chapter-item px-6 py-4 cursor-pointer hover:bg-slate-50 text-sm transition-all border-b border-slate-50 flex justify-between">
                    <span>${ch}</span>
                </div>
            `).join('');
        }

        function loadChapter(ch) {
            currentChapter = ch;
            localStorage.setItem('lastChapter', ch);
            document.querySelectorAll('.chapter-item').forEach(el => el.classList.remove('active'));
            document.getElementById(`nav-${ch}`).classList.add('active');
            document.getElementById('currentChapterTitle').innerText = ch;

            let list = allData.filter(item => item.chapter === ch);
            if (document.getElementById('hideMastered').checked) {
                list = list.filter(item => !masteredWords.has(item.word));
            }
            renderList(list);
        }

        function renderList(data) {
            const container = document.getElementById('vocabList');
            container.innerHTML = data.map(item => {
                const isM = masteredWords.has(item.word);
                return `
                <div class="bg-white p-6 rounded-2xl shadow-sm border ${isM ? 'word-card mastered' : 'border-slate-100'} relative">
                    <div class="flex justify-between mb-4">
                        <h3 class="text-2xl font-bold">${item.word}</h3>
                        <div class="flex gap-2">
                            <button onclick="toggleMastered('${item.word}')" class="text-xl" title="æŒæ¡">${isM ? 'âœ…' : 'ğŸ”˜'}</button>
                            <button onclick="speak('${item.word}')" class="text-slate-300 hover:text-blue-500">ğŸ”Š</button>
                        </div>
                    </div>
                    <div class="blur-content space-y-3" onclick="this.classList.toggle('active')">
                        <div class="text-blue-600 font-mono text-sm">${item.phonetic || ''}</div>
                        <p class="text-sm font-bold text-slate-700">${item.meaning_cn || ''}</p>
                        <div class="bg-slate-50 p-3 rounded-xl text-xs italic text-slate-600 border-l-2 border-blue-400">"${item.sentence_en || ''}"</div>
                    </div>
                </div>`;
            }).join('');
        }

        function setMode(mode) {
            isReviewMode = (mode === 'review');
            document.getElementById('vocabList').classList.toggle('review-mode', isReviewMode);
            document.getElementById('nBtn').className = mode==='normal' ? 'px-5 py-2 rounded-lg text-sm font-semibold bg-blue-600 text-white shadow-sm' : 'px-5 py-2 rounded-lg text-sm font-semibold text-slate-500';
            document.getElementById('rBtn').className = mode==='review' ? 'px-5 py-2 rounded-lg text-sm font-semibold bg-blue-600 text-white shadow-sm' : 'px-5 py-2 rounded-lg text-sm font-semibold text-slate-500';
        }

        function toggleHideMastered() { loadChapter(currentChapter); }
        function speak(text) { window.speechSynthesis.speak(new SpeechSynthesisUtterance(text)); }

        init();
    </script>
</body>
</html>
