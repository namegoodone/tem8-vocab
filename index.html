<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸“å…«è¯æ±‡Â·é«˜æ•ˆæ¶ˆç­ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; background-color: #f8fafc; color: #1e293b; }
        .main-content { height: 100vh; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        /* æ¨¡ç³Šæ•ˆæœ */
        .review-mode .blur-content { filter: blur(15px); transition: filter 0.3s; cursor: pointer; }
        .review-mode .blur-content.active { filter: blur(0); }
        /* æŒæ¡åæ¶ˆå¤±åŠ¨ç”» */
        .card-exit { transform: translateX(100%); opacity: 0; transition: all 0.4s ease; }
        .chapter-card.active { border-color: #3b82f6; background-color: #eff6ff; }
    </style>
</head>
<body class="flex flex-col lg:flex-row">

    <aside class="w-full lg:w-80 bg-white border-r border-slate-200 flex flex-col h-auto lg:h-screen shrink-0">
        <div class="p-6 border-b bg-slate-50">
            <h2 class="text-2xl font-black mb-4">å­¦ä¹ è¿›åº¦</h2>
            <div class="grid grid-cols-2 gap-2">
                <button onclick="syncCopy()" class="bg-blue-600 text-white py-3 rounded-xl text-xs font-bold">å¤åˆ¶åŒæ­¥ç </button>
                <button onclick="syncPaste()" class="bg-slate-800 text-white py-3 rounded-xl text-xs font-bold">ç²˜è´´åŒæ­¥ç </button>
            </div>
        </div>
        <div id="chapterStats" class="flex-1 overflow-y-auto p-4 space-y-3">
            </div>
    </aside>

    <main class="main-content flex-1 p-4 lg:p-8" id="scrollContainer">
        <header class="max-w-3xl mx-auto mb-6 flex justify-between items-center">
            <h1 id="currentTitle" class="text-2xl font-bold">è¯·é€‰æ‹©ç« èŠ‚</h1>
            <div class="flex bg-white p-1 rounded-xl shadow-sm border">
                <button onclick="setMode('normal')" id="nBtn" class="px-6 py-2 rounded-lg text-sm font-bold bg-blue-600 text-white">æµè§ˆ</button>
                <button onclick="setMode('review')" id="rBtn" class="px-6 py-2 rounded-lg text-sm font-bold text-slate-400">å¤ä¹ </button>
            </div>
        </header>

        <div id="vocabList" class="max-w-3xl mx-auto space-y-6 pb-40">
            </div>
    </main>

    <script>
        let allData = [];
        let masteredWords = new Set();
        let isReviewMode = false;
        let currentChapter = "";

        async function init() {
            const saved = localStorage.getItem('vocab_sync_v3');
            if (saved) {
                const p = JSON.parse(saved);
                masteredWords = new Set(p.mastered || []);
                currentChapter = p.lastChapter;
            }

            try {
                const res = await fetch('vocab.json');
                allData = await res.json();
                renderStats();
                if (currentChapter) loadChapter(currentChapter);
            } catch (e) {
                alert("è¯·ç¡®ä¿ vocab.json åœ¨åŒçº§ç›®å½•å¹¶ä½¿ç”¨æœåŠ¡å™¨æ‰“å¼€ã€‚");
            }
        }

        function renderStats() {
            const groups = [...new Set(allData.map(d => d.chapter))];
            const container = document.getElementById('chapterStats');
            
            container.innerHTML = groups.map(ch => {
                const list = allData.filter(d => d.chapter === ch);
                const masteredCount = list.filter(d => masteredWords.has(d.word)).length;
                const remaining = list.length - masteredCount;
                const isActive = ch === currentChapter;

                return `
                <div onclick="loadChapter('${ch}')" class="chapter-card p-4 rounded-2xl border-2 cursor-pointer transition-all ${isActive ? 'active shadow-md' : 'bg-white border-transparent hover:border-slate-200'}">
                    <div class="font-bold text-slate-800 mb-2">${ch}</div>
                    <div class="flex gap-3 text-[11px] font-bold uppercase tracking-wider">
                        <span class="text-emerald-600">å·²æŒæ¡ ${masteredCount}</span>
                        <span class="text-blue-500">å¾…å­¦ä¹  ${remaining}</span>
                    </div>
                </div>`;
            }).join('');
        }

        function loadChapter(ch) {
            currentChapter = ch;
            saveProgress();
            renderStats(); // åˆ·æ–°ä¾§è¾¹æ ç»Ÿè®¡
            document.getElementById('currentTitle').innerText = ch;
            
            // åªè¿‡æ»¤å‡ºâ€œæœªæŒæ¡â€çš„å•è¯æ˜¾ç¤º
            const list = allData.filter(d => d.chapter === ch && !masteredWords.has(d.word));
            renderList(list);
            document.getElementById('scrollContainer').scrollTop = 0;
        }

        function renderList(data) {
            const container = document.getElementById('vocabList');
            if (data.length === 0) {
                container.innerHTML = `<div class="py-20 text-center text-slate-400 font-bold italic">ğŸ‰ æœ¬ç« å·²å…¨éƒ¨æ”»å…‹ï¼</div>`;
                return;
            }

            container.innerHTML = data.map(item => `
                <div id="card-${item.word}" class="bg-white rounded-[2.5rem] shadow-xl shadow-slate-200/50 border border-white overflow-hidden transition-all duration-300">
                    <div class="p-8">
                        <div class="flex justify-between items-start mb-6">
                            <div>
                                <h3 class="text-4xl font-black tracking-tight text-slate-900">${item.word}</h3>
                                <div class="text-blue-600 font-mono text-xl mt-1 font-bold">${item.phonetic || ''}</div>
                            </div>
                            <button onclick="markMastered('${item.word}')" class="group flex flex-col items-center gap-1">
                                <div class="w-16 h-16 rounded-2xl border-4 border-slate-100 flex items-center justify-center group-hover:bg-emerald-500 group-hover:border-emerald-500 transition-all">
                                    <svg class="w-8 h-8 text-slate-200 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M5 13l4 4L19 7"></path></svg>
                                </div>
                                <span class="text-[10px] font-black text-slate-300 uppercase">æŒæ¡</span>
                            </button>
                        </div>

                        <div class="blur-content space-y-6" onclick="this.classList.toggle('active')">
                            <div class="bg-slate-900 text-white p-6 rounded-2xl">
                                <p class="text-[10px] text-slate-400 uppercase font-black mb-1 tracking-widest">ä¸­æ–‡è§£é‡Š</p>
                                <p class="text-3xl font-black leading-tight">${item.meaning_cn || ''}</p>
                            </div>

                            <p class="text-xl font-medium text-slate-600 leading-relaxed">${item.definition_en || ''}</p>
                            
                            <div class="bg-blue-50 p-6 rounded-[1.5rem] border-l-[12px] border-blue-400 relative">
                                <p class="text-xl italic text-slate-800 leading-relaxed font-serif">"${item.sentence_en || ''}"</p>
                                <p class="text-lg text-blue-500 font-bold mt-4 text-right">â€” ${item.sentence_cn || ''}</p>
                            </div>
                        </div>
                    </div>
                </div>`).join('');
        }

        function markMastered(word) {
            const card = document.getElementById(`card-${word}`);
            card.classList.add('card-exit'); // è§¦å‘æ¶ˆå¤±åŠ¨ç”»
            
            setTimeout(() => {
                masteredWords.add(word);
                saveProgress();
                loadChapter(currentChapter); // åˆ·æ–°åˆ—è¡¨ï¼Œè¯¥å•è¯æ¶ˆå¤±
            }, 400);
        }

        function saveProgress() {
            localStorage.setItem('vocab_sync_v3', JSON.stringify({
                mastered: [...masteredWords],
                lastChapter: currentChapter
            }));
        }

        function syncCopy() {
            const code = btoa(unescape(encodeURIComponent(JSON.stringify({
                mastered: [...masteredWords],
                lastChapter: currentChapter
            }))));
            navigator.clipboard.writeText(code).then(() => alert("åŒæ­¥ç å·²å¤åˆ¶ï¼"));
        }

        function syncPaste() {
            const code = prompt("ç²˜è´´åŒæ­¥ç ï¼š");
            if (code) {
                try {
                    const p = JSON.parse(decodeURIComponent(escape(atob(code))));
                    masteredWords = new Set(p.mastered);
                    currentChapter = p.lastChapter;
                    saveProgress();
                    location.reload();
                } catch(e) { alert("åŒæ­¥ç æ— æ•ˆ"); }
            }
        }

        function setMode(m) {
            isReviewMode = (m === 'review');
            document.getElementById('vocabList').classList.toggle('review-mode', isReviewMode);
            document.getElementById('nBtn').className = m==='normal' ? 'px-6 py-2 rounded-lg text-sm font-bold bg-blue-600 text-white' : 'px-6 py-2 rounded-lg text-sm font-bold text-slate-400';
            document.getElementById('rBtn').className = m==='review' ? 'px-6 py-2 rounded-lg text-sm font-bold bg-blue-600 text-white' : 'px-6 py-2 rounded-lg text-sm font-bold text-slate-400';
        }

        init();
    </script>
</body>
</html>
